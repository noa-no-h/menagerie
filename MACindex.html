<!doctype HTML>
<html>
<head>
	<title>Research Study</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
	<script src="https://www.google.com/recaptcha/api.js" async defer></script>
	<script src="papaparse.min.js"></script>
	<script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/jspsych-call-function.js"></script>
    <script src="jspsych/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych/plugins/jspsych-html-slider-response.js"></script>
    <script src='jspsych/plugins/jspsych-multiple-slider.js'></script>
    <script src='jspsych/plugins/jspsych-survey-likert.js'></script>
    <script src='jspsych/plugins/jspsych-instructions.js'></script>
    <script src='jspsych/plugins/jspsych-survey-text.js'></script>
    <script src='jspsych/plugins/jspsych-survey-multi-choice.js'></script>
    <script src='jspsych/plugins/jspsych-survey-multi-choice-twocol.js'></script>
    <script src='jspsych/plugins/jspsych-survey-multi-choice-twocol-slider.js'></script>
    <script src='jspsych/plugins/jspsych-survey-multi-choice-twocol-button.js'></script>
    <script src='jspsych/plugins/jspsych-survey-multi-select.js'></script>
    <script src='jspsych/plugins/jspsych-external-html.js'></script>
    <script src='jspsych/plugins/jspsych-maxdiff.js'></script>
    <script src='jspsych/plugins/jspsych-html-button-response.js'></script>
    <script src='jspsych/plugins/jspsych-html-button-response-machoice.js'></script>
    <script src='jspsych/plugins/jspsych-fullscreen.js'></script>
	<link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css">
	<script src='trials_db.js'></script>
	<script src='practice_trials_db.js'></script>
    <link href="my.css" rel="stylesheet" type="text/css">
    <script src="utilities.js"></script>
	<link href="jspsych/css/ma-choice-jspsych.css" rel="stylesheet" type="text/css">
	<style>
		td, th {padding: 20px;}
		.big {font-size: 40px;}
		.med {font-size: 24px;}
		td {
			position: relative;
		}
		.bg {
			position: absolute;
			left: 0;
			top: 0;
			bottom: 0;
			/* background-color: rgba(223, 168, 117, 0.692); */
			/* background-color: rgb(236, 190, 120); */
			background-color: #d3cd98;

			z-index: -1;
		}
		.bg2 {
			position: absolute;
			left: 0;
			top: 0;
			bottom: 0;
			/* background-color: rgba(117, 190, 223, 0.801); */
			/* background-color: rgba(132, 196, 148, 0.925); */
			background-color: #c5dde0;


			z-index: -1;
		}
	</style>
</head>
<body>
</body>
<script>

// ***Setting Up the Experiment***

// Meta-var's
var study_version = "ma_choice_v4_movie_observers_real1";
var both_halves = false;

var turk_code = "JSALK23";
var study_time = 55;
var study_money = 11;

// // find the assignmentId & debugging status from the URL
var urlParams = parseURLParams(window.location.href);
var subject_id_url = '';
var debug = false;
if (typeof urlParams != "undefined") {
    if (urlParams.hasOwnProperty('PROLIFIC_PID')) {
        subject_id_url = urlParams.PROLIFIC_PID[0];
    }

    if (urlParams.hasOwnProperty('debug')) {
        debug = urlParams.debug[0];
    }
}


var movie_scale = ['Very Bad', 'Bad', 'Moderate', 'Good', 'Very Good'];

// if scale is null, must include postfix
//"artistic","funny","romantic","visual","great acting","plot","dialogue","awesome soundtrack","good action"
var home_attributes = [
	{name: 'artistic', scale: null, lb: 0, ub: 100, postfix: '', display_name: 'Creativity', round_to: 10},
	{name: 'funny', scale: null, lb: 0, ub: 100, postfix: '', display_name: 'Humor', round_to: 10},
	{name: 'romantic', scale: null, lb: 0, ub: 100, postfix: '', display_name: 'Romantic Scenes', round_to: 10},
	{name: 'visual', scale: null, lb: 0, ub: 100, postfix: '', display_name: 'Visuals', round_to: 10},
	{name: 'great acting', scale: null, lb: 0, ub: 100, postfix: '', display_name: 'Acting', round_to: 10},
	{name: 'plot', scale: null, lb: 0, ub: 100, postfix: '', display_name: 'Plot', round_to: 10},
	{name: 'dialogue', scale: null, lb: 0, ub: 100, postfix: '', display_name: 'Dialogue', round_to: 10},
	{name: 'awesome soundtrack', scale: null, lb: 0, ub: 100, postfix: '', display_name: 'Soundtrack', round_to: 10},
	{name: 'good action', scale: null, lb: 0, ub: 100, postfix: '', display_name: 'Action Scenes', round_to: 10},
];

var home_attribute_names = [];
for (i = 0; i < home_attributes.length; i++) {
	home_attribute_names.push(home_attributes[i].name);
}

var home_attribute_display_names = [];
for (i = 0; i < home_attributes.length; i++) {
	home_attribute_display_names.push(home_attributes[i].display_name);
}

var num_attributes_to_use = home_attributes.length;
var num_practice_trials = 10;
var num_trials = 100;
var num_practice_trials_to_use = num_practice_trials;
var num_trials_to_use = num_trials;
var trial_wait_time = 7000;
var num_attributes_to_ask_about = home_attributes.length;

// parameters for OBSERVERS

var num_target_subjects = trials_db.length;
prac_trials_db = prac_trials_db.slice(0,num_target_subjects);
trials_db = trials_db.slice(0,num_target_subjects);

if (debug) {
	num_practice_trials_to_use = 2;
	num_trials_to_use = 1;
	trial_wait_time = 0;
}

/* BEGIN */

function generateAttributeValues(cur_attributes){
	var arr = [];
	for (let j=0;j<cur_attributes.length;j++){
		cur_att = cur_attributes[j];
		if (cur_att.scale == null) {
			var rand1 = Math.floor(Math.random() * (cur_att.ub - cur_att.lb)) + cur_att.lb;
			var rand2 = -1;
			do {
				rand2 = Math.floor(Math.random() * (cur_att.ub - cur_att.lb)) + cur_att.lb;
			} while(Math.abs(rand2 - rand1) < cur_att.min_diff);
			arr.push([cur_att.name, Math.round(rand1/cur_att.round_to)*cur_att.round_to + cur_att.postfix, Math.round(rand2/cur_att.round_to)*cur_att.round_to + cur_att.postfix]);
				//}
		} else {
			var rand1 = Math.floor(Math.random() * cur_att.scale.length);
			var rand2 = -1;
			do {
				rand2 = Math.floor(Math.random() * cur_att.scale.length);
			} while(Math.abs(rand2 - rand1) < cur_att.min_diff);
			arr.push([cur_att.name, cur_att.scale[rand1], cur_att.scale[rand2]]);
		}
	}
return arr;
}


function generateTable(cur_attributes,cur_opt1,cur_opt2) {
	let tbl_html = "<div align='center'><table border = 2px solid black><thead>\
	</tr><tr><th></th><td><b><u>Movie A</u></b></td><td><b><u>Movie B</u></b></td>";

	for (var i = 0; i < cur_attributes.length; i++) {
		var first = Math.floor(cur_opt1[i]/20);
		var second = Math.floor(cur_opt2[i]/20);

		if (first < 0) {
			first = 0;
		} else if (first > 4) {
			first = 4;
		}
		if (second < 0) {
			second = 0;
		} else if (second > 4) {
			second = 4;
		}

		// get display name
		var display_name = home_attribute_display_names[home_attribute_names.indexOf(cur_attributes[i])];

    cell_one_html = "<div class='container'><div class='skills php'>1%</div>"
		tbl_html += "<tr><th>"+display_name+"</th><td><div class='bg' style='width: "+(first*25)+"%'></div>"+movie_scale[first]+"</td>\
			<td><div class='bg2' style='width: "+(second*25)+"%'></div>"+movie_scale[second]+"</td>";
	}

	tbl_html += '</tr></table><br>';
	return tbl_html;
}


/* STUFF FOR OBSERVERS */

// funtion to get participant counter
function getCounter(url, datDir) {
	let numCounter = 0;
	$.ajax({
			url: url,
			type: 'POST',
			async: false,
			data: { dir: datDir },
	}).done(function (data) {
			numCounter = data;
	});
	return numCounter;
}

function write_array_to_csv(filename, arr) {
	$.ajax({
			url: "write_array_to_csv.php",
			type: 'POST',
			async: false,
			data: {arr: arr.toString(), filename: filename},
			success: function(response) {
				console.log(response);
			}
	});
}

x = getCounter("counter.php");
y = parseInt(x)

// deal with y > # past subjects (b/c of dropout in observer study)
// overall plan:
// start back at y - # past subjects
// find lowest number above that that's not completed & not being redone; assign y = that (but don't update counter.txt)
// if there are none, randomly sample from being_redone
// if there are none in being_redone, randomly sample from 1 to num_targets

var past_end = false;
var target_num = y;

// this is "while" instead of "if" in case counter went over num_target_subjects*2
while (target_num >= num_target_subjects) {
	target_num = target_num - num_target_subjects; // restart at 0
	past_end = true;
}

// get past subjects that have already been completed
var completed = null;
var being_redone = null;

// if we're not past end, just keep as is
if (past_end) {
	var is_being_redone = true;

	// if we are past end, we need to get completed & being_redone synchronously
	$.ajax({
			type: "GET",
			url: "https://amorris.mprlab327.opalstacked.com/ma_choice/v4_movie_observers/completed.csv",
			dataType: "text",
			async: false,
			success: function(d) {
				if (d.length > 0) {
					completed = Papa.parse(d, {dynamicTyping: true}).data[0];
				} else {
					completed = [];
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
					alert("Status: " + xhr.status + "     Error: " + thrownError);
			}
	});

	$.ajax({
			type: "GET",
			url: "https://amorris.mprlab327.opalstacked.com/ma_choice/v4_movie_observers/being_redone.csv",
			dataType: "text",
			async: false,
			success: function(d) {
				if (d.length > 0) {
					being_redone = Papa.parse(d, {dynamicTyping: true}).data[0];
				} else {
					being_redone = [];
				}
			},
			error: function(xhr, ajaxOptions, thrownError) {
					alert("Status: " + xhr.status + "     Error: " + thrownError);
			}
	});

	// assign y to the lowest value not in completed or being_redone.
	while (completed.includes(target_num) || being_redone.includes(target_num)) {
		if (target_num < (num_target_subjects - 1)) {
			target_num++;
		}
		else {
			// this means that there's no targets that are neither completed nor being_redone
			// in which case, check if there are any being redone...
			if (being_redone.length > 0) {
				// choose randomly from among them
				target_num = being_redone[Math.floor(Math.random() * being_redone.length)];
			} else {
				// otherwise, just choose randomly
				target_num = getRandomInt(0, num_target_subjects-1);
				is_being_redone = false; // if we're in this branch, it means that everything was completed, nothing is being redone, and we're just redoing one of the completed ones (cause why not).
			}

			break;
		}
	}

	if (is_being_redone) {
		being_redone.push(target_num);
		write_array_to_csv('being_redone.csv', being_redone);
	}
}

console.log(y)
console.log(target_num)

var start_instructions = 0;

// ***Intro Blocks***

var welcome = {
	type: 'instructions',
	pages: ['<b>Welcome to the ' + (both_halves ? 'first half of the ' : '') + 'research study on decision-making!</b>'],
	show_clickable_nav: true
}

var fullscreen = {
	type: "fullscreen",
	message: "We ask that you take this experiment in full screen mode. \
	When you click the 'Continue' button below, your browser will go full screen and you may start the study.<br><br>",
	fullscreen_mode: true,
};

var get_id = {
	type: 'survey-text',
	questions: [{prompt: "<b>Prolific ID:</b>", name: "worker_id"}],
	preamble: ["Please enter your <b>Prolific ID</b> below.<br>(When you're done, press <b>'Continue'</b>.)"],
};

var subject_id = '';
var get_id_loop = {
	timeline: [get_id],
	loop_function: function(data) {
		id = data.values()[0].response.worker_id;
		if (id) {
			jsPsych.data.addProperties({
				subject: id,
				version: study_version,
				assignmentId: subject_id_url
			});
			subject_id = id;

			// save att data
			for (var i = 0; i < home_attributes.length; i++) {
				att = home_attributes[i];
				att_data = {
					subject: id,
					version: study_version,
					assignmentId: subject_id_url,
					attribute: att.name,
					scale: att.scale == null ? '' : att.scale.toString(),
					min_diff: att.min_diff || null,
					lb: att.lb == undefined ? '' : att.lb,
					ub: att.ub == undefined ? '' : att.ub,
					postfix: att.postfix == undefined ? '' : att.postfix,
				}

				save_data(att_data, 'attributes');
			}

			start_instructions = Date.now();

			return false;
		} else {
			alert("Please provide your Prolific ID.");
			return true;
		}
	}
}

var check_consent = function(elem) {
	if ($('#consent_checkbox').is(':checked')) {
		return true;
	}
	else {
		alert("If you wish to participate, you must check the box next to the statement 'I agree to participate in this study.'");
		return false;
	}
	return false;
};

var consent_block = {
	type:'external-html',
	url: "consent.php?time=" + study_time + "&money=" + study_money + "&test=1",
	cont_btn: "start",
	check_fn: check_consent,
	force_refresh: true
};

// first attention check
var attnCheck1 = {
    type: 'survey-text',
    questions: [{prompt: 'Your response', name: 'attention_check', required: debug ? false : true}],
    preamble: ["In order to complete this study, you will need to pay close attention for its entire duration. If you do not pay close attention, your data will be unusable.\
		<b>Please do not take this study unless you have time and energy to pay attention for the full length of time.</b>\
		<br><br>Please type this exact sentence into the box below: 'I will complete this study with my full attention.' and then continue."],
    on_finish: function(data) {
    	jsPsych.data.addProperties({attention_check: data.response.attention_check});
    }
};

// ***Welcome and Task 1 Instructions***
var instructions_text = ['Please <b>do not</b> press the <b>back</b> button or <b>refresh</b> your browser during the study; if you do, you will have to start over. <br><br> Please click <b>Next</b> and read the following instructions carefully. <br></br>',

 	'<br></br>This study has two sections. Each section should take about 25 minutes.',

	'<h2><u>Section 1</u></h2> In Section 1, you will <b>observe a series of choices made by another real Prolific user</b>, and try to figure out what strategy they used to make their choices.<br><br>You will win <b>bonus money</b> at the end of the study based on how well you figure out their strategy.',

	"This Prolific user made a series of choices between <b>two movies whose trailers they might want to watch</b>.<br><br>\
	We didn't tell the Prolific user what the two movies were that they were choosing between. Instead, we told them <b>how well each movie performed on different dimensions</b>. For instance, we told them how good the acting was, how good the dialogue was, how good the action scenes were, and so on.",

	`Each movie received a score on each dimension, ranging from 'Very Bad' to 'Very Good'. \
	For instance, to tell the Prolific user how good the acting was, we showed them something like this:
	<br><br><img src='images/example_att1.png' width='25%''></img><br><br>
	In this case, the movie had very good acting. Here's another example:
	<br><br><img src='images/example_att2.png' width='25%''></img><br><br>
	In this case, the acting in the movie was bad.`,

	"These values don't necessarily mean how <i>much</i> the movie focused on that dimension. \
	For example, even if a movie scored well on action scenes, that doesn't necessarily mean the movie was an action movie. \
	It just means that the action scenes that the movie did have were good.<br><br>\
	In other words, when the Prolific user made their choices, they didn't know what <i>type</i> of movie it is (i.e. a romance, comedy, drama, etc). \
	They only knew which parts of the movie were good or bad. So they <b>had to make their choices based on which <b>parts</b> of the movie they cared about being good</b>.",

	"We described the full list of dimensions for the Prolific user in a table. For instance, here are two movies that the Prolific user might have been asked to choose between:<br><br>\
	<img src='images/example_table.png' width='20%''></img>\
	<br><br>The Prolific user chose the movie whose trailer they'd rather watch. <b>Your job will be to figure out what strategy the Prolific user used to make their choices.</b> Remember, you will win bonus money at the end of the study based on how well you figure out their strategy.",

	"Critically, at the end of the study, the Prolific user had to <b>actually watch the trailer</b> of one of the movies they choose. We randomly selected one of their choices and showed them the trailer of that movie. So their choices <b>actually mattered</b> for their experience in the study.",

	"We told the Prolific user that shouldn't try to \"figure out\" what each movie was, beyond what we showed them on the screen; we wanted them to choose as best they could based on the information they were shown.<br><br>\
	Also, when making their choices, we told them to <b>assume that these are the only two movies available</b>, and they have to choose one of them. Sometimes the two movies might both have been bad choices from their perspective. We told them that that's okay -- they should just do their best to choose the movie whose trailer they'd rather watch if those were their only two options.",

	"We'll ask you to spend spend some time looking at each movie before we tell you what choice the Prolific user made. On each trial, after " + (trial_wait_time / 1000) + " seconds, two buttons will appear like this:<br><br>\
	<img src='images/example_buttons_obs.png'></img><br><br>\
	One of them will be highlighted in green. <b>The button highlighted in green is the one the Prolific user chose.</b><br><br>\
	We'll ask you to <b>press the button that the Prolific user chose</b> in order to proceed to the next trial. For instance, if the person chose Movie A (and the 'Movie A' button is highlighted in green), you should select Movie A to continue. But you can take as much time as you need to look at the two movie options before pressing the button.",

	"The Prolific user first completed " + num_practice_trials_to_use + " practice trials.<br><br>\
	When you're ready to see them, please continue."
];

var instructions_times = Array();
 var instructions = {
	type: "instructions",
	pages: instructions_text,
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
}

var att_list = '<ul style="text-align: left">';
for (var i = 0; i < home_attributes.length; i++) {
	var cur_att = home_attributes[i];
	att_list += '<li style="list-style-type: none;">';
	att_list += '<b>' + cur_att.display_name + '</b> ';
}
att_list += '</ul>';

var instructions2 = {
	type: 'instructions',
	pages: ["Great job. Let's move on to the Prolific user's real trials.",
		"Here's how the bonus payment will work. After you observe all the person's choices, we will ask you a series of questions about how you think they made their choices.<br><br>\
		Then, after you complete the study, we will <b>compare your answers to the person's actual strategy</b>, and give you bonus money based on how close you got.<br><br>\
		You could earn up to a maximum of $1 in bonus money, if you can get really close to the true strategy the person used.",
		"Just to remind you, here's the full list of features that differed across the two movies:<br><br>" + att_list +"<br> Each feature ranged from 'Very Bad' to 'Very Good'.<br><br>",
		"The Prolific user completed " + num_trials_to_use + " real trials in total. Please do your best to pay attention throughout this whole section, and try to figure out how the person was making their choices.<br><br>\
		When you're ready to start, press 'Next'."],
		show_clickable_nav: true,
		on_finish: function(data) {
			for (var i = 0; i < data.view_history.length; i++) {
				instructions_times.push(Math.round(data.view_history[i].viewing_time));
			}
		}
}

var practice_trials = [];
for (var i = 0; i < num_practice_trials; i++) {
	var cur_attributes = prac_trials_db[target_num][i]["attributes"].split(',');
	var cur_opt1 = prac_trials_db[target_num][i]["opt1_values"].split(',');
	var cur_opt2 = prac_trials_db[target_num][i]["opt2_values"].split(',');
	var cur_choice = prac_trials_db[target_num][i]["choice"];

	var tbl = generateTable(cur_attributes,cur_opt1,cur_opt2);

	practice_trials.push({
		 type: 'html-button-response-machoice',
		 stimulus: tbl,
		 choices: ['Movie A','Movie B'],
		 orig_choice: cur_choice,
		 prompt: '<br>Please select the movie the person chose (highlighted in green).<br><small>(Trial ' + (i+1) + ' out of ' + num_practice_trials_to_use + ')</small>',
		 button_duration: trial_wait_time, //how long to hide buttons
 		 data: {which_trial: i, att_names: cur_attributes, atts_opt1: cur_opt1, atts_opt2: cur_opt2, orig_choice: cur_choice},
		 on_finish: function(data) {
			 s1_data = {
				 subject: data.subject,
				 version: data.version,
				 assignmentId: subject_id_url,
				 trial: data.which_trial,
				 practice: 1,
				 opt1_id: -1,
				 opt2_id: -1,
				 attributes: data.att_names.toString(),
				 opt1_values: data.atts_opt1.toString(),
				 opt2_values: data.atts_opt2.toString(),
				 choice: data.response,
				 orig_choice: data.orig_choice,
				 rt: data.rt
			 }

			 save_data(s1_data, 's1');
		 }
	 });
}

var trials = [];
for (var i = 0; i < num_trials; i++) {
	var cur_attributes = trials_db[target_num][i]["attributes"].split(',');
	var cur_opt1 = trials_db[target_num][i]["opt1_values"].split(',').map(Number);
	var cur_opt2 = trials_db[target_num][i]["opt2_values"].split(',').map(Number);
	var cur_choice = trials_db[target_num][i]["choice"];

	var tbl = generateTable(cur_attributes,cur_opt1,cur_opt2);

	trials.push({
		 type: 'html-button-response-machoice',
		 stimulus: tbl,
		 choices: ['Movie A','Movie B'],
		 orig_choice: cur_choice,
		 prompt: '<br>Please select the movie the person chose.<br><small>(Trial ' + (i+1) + ' out of ' + num_trials_to_use + ')</small>',
		 button_duration: trial_wait_time, //how long to hide buttons
 		 data: {which_trial: i, att_names: cur_attributes, atts_opt1: cur_opt1, atts_opt2: cur_opt2, orig_choice: cur_choice},
		 on_finish: function(data) {
			 s1_data = {
				 subject: data.subject,
				 version: data.version,
				 assignmentId: subject_id_url,
				 trial: data.which_trial,
				 practice: 0,
				 opt1_id: -1,
				 opt2_id: -1,
				 attributes: data.att_names.toString(),
				 opt1_values: data.atts_opt1.toString(),
				 opt2_values: data.atts_opt2.toString(),
				 choice: data.response,
				 orig_choice: data.orig_choice,
				 rt: data.rt
			 }

			 save_data(s1_data, 's1');
		 }
	 });
}

var fixation = {
    type: 'html-keyboard-response',
    stimulus: '<span style="font-size:40px;">+</span>',
    choices: jsPsych.NO_KEYS,
    trial_duration: 1000
}

var question_rts = new Object();

//*** Survey Questions ***
var attribute_instructions = {
	type: 'instructions',
	pages: ["Great work. You've completed Section 1.",
	"<h2><u>Section 2</u></h2> Now, in Section 2, we are going to ask you to reflect on the decisions you just observed in Section 1, and how you think the Prolific user considered the various features of each movie while making their choices.",
	],
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

// Overarching feature questions

var strat_instructions_intro = {
	type: 'instructions',
	pages: ["On the next few pages, we're going to ask you some questions about the <b>big-picture decision-making strategies</b> people might use when choosing between movies in Section 1.<br><br>\
	The strategies are not mutually exclusive, or all-or-nothing; people could be somewhere in the middle, or use one strategy on some trials and then another strategy on other trials. The strategies are meant to capture aspects of how people made their choices, not necessarily to describe their entire thought process. Just do your best to understand each strategy and answer the questions as accurately as you can."],
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

function get_strat_labels(word1, word2, type) {
	var lbls = null;
	if (type == 'real') {
		lbls = ['<b>Strategy ' + word1 + ' much better</b> describes how <b>the Prolific user</b> made their choices', '', '<b>Strategy ' + word1 + ' somewhat better</b> describes how <b>the Prolific user</b> made their choices', '', '<b>Both strategies equally</b> describe how <b>the Prolific user</b> made their choices', '', '<b>Strategy  ' + word2 + '  somewhat better</b> describes how <b>the Prolific user</b> made their choices', '', '<b>Strategy  ' + word2 + '  much better</b> describes how <b>the Prolific user</b> made their choices'];
	} else if (type == 'comp') {
		lbls = ['<b>Strategy ' + word1 + ' much better</b> describes how this person made their choices', '', '<b>Strategy ' + word1 + ' somewhat better</b> describes how this person made their choices', '', '<b>Both strategies equally</b> describe how this person made their choices', '', '<b>Strategy ' + word2 + ' somewhat better</b> describes how this person made their choices', '', '<b>Strategy ' + word2 + ' much better</b> describes how this person made their choices'];
	} else if (type == 'norm') {
		lbls = ['<b>Strategy ' + word1 + ' much better</b> describes how someone <b>SHOULD</b> make their choices', '', '<b>Strategy ' + word1 + ' somewhat better</b> describes how someone <b>SHOULD</b> make their choices', '', '<b>Both strategies equally</b> describe how someone <b>SHOULD</b> make their choices', '', '<b>Strategy ' + word2 + ' somewhat better</b> describes how someone <b>SHOULD</b> make their choices', '', '<b>Strategy ' + word2 + ' much better</b> describes how someone <b>SHOULD</b> make their choices'];
	}
	return(lbls);
}

var strat_preamble = 'Here are the two strategies described again, for reference.';
var strat_post_intro = "<br>When you feel like you've understood the two strategies, press 'Continue'.";

var strat_posts = [
'<br><b>Now</b>, read the following description of a person, and answer: <b>Which of the two strategies better reflects how this person made their choices?</b><br><br>',
'<br><b>Now</b>, read this description of a different person, and answer again: <b>Which of the two strategies better reflects how this person made their choices?</b><br><br>'
];

var strat_post_real = '<br><b>Next</b>, we want to know: Which of the two strategies better reflects how you think the <b>Prolific user you observed</b> made <b>THEIR</b> choices in Section 1 of the task?<br><br>';
var strat_post_norm = '<br><b>Finally</b>, we want to know: Which of the two strategies better reflects how someone <b>SHOULD</b> make choices in Section 1 of the task? Which is the right strategy, or the better one?<br><br>';

var strat_middle1 = {
	type: 'instructions',
	pages: ["Now, we're going to show you another two big-picture strategies.<br><br>When you're ready, press 'Next'."],
	show_clickable_nav: true
}

var strat_middle2 = {
	type: 'instructions',
	pages: ["Finally, we're going to show you the last two big-picture strategies.<br><br>When you're ready, press 'Next'."],
	show_clickable_nav: true
}

var strat_order_words = [['A', 'B'], ['C', 'D'], ['E', 'F']];
var strat_q_order = _.shuffle(['lex', 'binwts', 'binatts']);

var strat_instr = [[`First, we're going to describe two strategies -- <b>Strategy A</b> and <b>Strategy B</b> -- that a person could have used to make choices in Section 1.`],
									 [`Next, we're going to describe another two big-picture strategies -- <b>Strategy C</b> and <b>Strategy D</b> -- that a person could have used to make choices in Section 1.`],
									 [`Finally, we're going to describe a last two big-picture strategies -- <b>Strategy E</b> and <b>Strategy F</b> -- that a person could have used to make choices in Section 1.`]];
var strat_instr_trial = new Array(3);

for (var q = 0; q < 3; q++) {
	var strat_order_word = strat_order_words[q];

	if (strat_q_order[q] == 'lex') {
		var to_add = [
			"<b>Strategies " + strat_order_word[0] + "</b> and <b>" + strat_order_word[1] + "</b> are about the number of features of the movies that a person cared about when making their choices.",

			"A person using <b>Strategy " + strat_order_word[0] + "</b> made all their decisions based off a <b>single, all-important feature</b> and \
			did not consider the other features.\
			<br><br>For instance, if someone only cared about the quality of the plot (and no other features) when making all their decisions, their strategy might look like this:<div style='text-align: center'><img src='images/lex-strat-1.png' width=70%></div><br>\
			Of course, the person might have cared about a different feature than the one in this example. But the point is that they only cared about one feature throughout all their choices.",

			"In contrast, a person using <b>Strategy " + strat_order_word[1] + "</b> considered <b>multiple features</b> of the movies when making each of their decisions.<br><br>\
			For instance, if, when making each of their decisions, someone cared about the acting, plot, and visuals, then their strategy might look like this: <div style='text-align: center'><img src='images/lex-strat-2.png' width=60%></div><br>\
			Of course, the person might have cared about different features than the ones in this example. But the point is that, during each choice, they cared about more than one feature."];

		var lex_options = [
			'The person made all their decisions based off a <b>single, all-important feature</b> and did not consider the other features.',
			'The person considered <b>multiple features</b> of the movies when making each of their choices.'];

	} else if (strat_q_order[q] == 'binwts') {
		var to_add = [
			"<b>Strategies " + strat_order_word[0] + "</b> and <b>" + strat_order_word[1] + "</b> are about how a person weighed together the features of the movies they cared about when making their choices.",

			"A person using <b>Strategy " + strat_order_word[0] + "</b> cared about some features of the movies and didn't care about others. Critically, for the features they did care about, they <b>cared about them all equally</b>.<br><br>\
			For instance, if the three features the person cared about the acting, plot, and visuals, they cared about those features <i>equally</i> when making their choices. \
			Their thinking might look like this: <div style='text-align: center'><img src='images/ew-strat-1.png' width=65%></div><br>\
			Of course, the person might have cared about different features (or a different number of features) than the ones in this example. Which features they cared about doesn't matter. \
			The point is that, for the features they <i>did</i> care about, they cared about them all an equal amount.",
			"Another way to put it is that, for <b>Strategy " + strat_order_word[0] + "</b>, the person either cared about a feature or didn't. There was no in-between (e.g. they didn't care about some features 'a little' versus 'a lot').",

			"In contrast, a person using <b>Strategy " + strat_order_word[1] + "</b> placed a <b>different amount of importance</b> on <b>different features they cared about</b>.<br><br>\
			For instance, if the three features the person considered about the acting, plot, and visuals, they cared about some of those features more than others when making their choices. \
			Their thinking might look like this: <div style='text-align: center'><img src='images/ew-strat-2.png' width=60%></div><br>\
			Of course, they might have cared about different features (or a different number of features) than the ones in this example. Which features they cared about doesn't matter. The point is that, for the features they <i>did</i> care about, they cared about some more than others.",
			"Another way to put it is that, for <b>Strategy " + strat_order_word[1] + "</b>, the person cared about some features a little and some features a lot."
		];

		var binwts_options = [
			"For the features the person cared about, the person <b>cared about them all equally</b>. (In other words, the person either cared about a feature or they didn't; there was no in-between.)",
			"For the features the person cared about, the person <b>placed a different amount of importance on different ones</b>. (In other words, the person might have cared about some features a little and some a lot.)"];
	} else if (strat_q_order[q] == 'binatts') {
		var to_add = [
			"<b>Strategies " + strat_order_word[0] + "</b> and <b>" + strat_order_word[1] + "</b> are about how a person compared the two movies on each feature.",

			"A person using <b>Strategy " + strat_order_word[0] + "</b> compared the movies on each feature based just on <b>which</b> movie was better or worse on that feature, \
			but NOT <b>how much</b> better or worse it was.<br><br>\
			For instance, if the person was considering how good the dialogue was, they only checked <i>which</i> movie had better dialogue; \
		 	they didn't care about how <i>MUCH</i> better the dialogue was. Similarly, if the person was considering how good the action scenes were, they only checked which movie had better action scenes; they didn't care about how <i>much</i> better they were. \
			Their thinking might look like this: <div style='text-align: center'><img src='images/wp-strat-1.png' width=45%></div><br>\
			In this case, it wouldn't matter whether the dialogue in Movie A was way better, or only a little better; the person would treat them the same. All that matters to this person is that Movie A has better dialogue.<br><br>\
			Of course, the person might have cared about different features than the ones in this example. But the point is that, for the features they did care about, they only considered which movie was better or worse on each of those features (not how <i>much</i> better or worse it was).",
			"Another way to put it is that, for <b>Strategy " + strat_order_word[0] + "</b>, the person just checked whether a movie 'won' on each feature, and didn't care about whether it won by a lot or a little.",

			"In contrast, a person using <b>Strategy " + strat_order_word[1] + "</b> went beyond checking which movie was better or worse on each feature, and instead cared about <b>how much</b> better or worse it was.<br><br>\
			For instance, if the person was considering how good the dialogue and action scenes were, they cared about how <i>much</i> better the dialogue was, or how <i>much</i> better the action scenes were. \
			Their thinking might look like this: <div style='text-align: center'><img src='images/wp-strat-2.png' width=90%></div><br>\
			Of course, the person might have cared about different features than the ones in this example. But the point is that, for the features they did care about, they considered how <i>much</i> better or worse each movie was on those features."
		];

		var binatts_options = [
			"When the person compared the two movies on a feature, they only checked <b>which</b> movie was better or worse on that feature (i.e. which movie 'won' that feature), and didn't care about how much better or worse it was on that feature.",
			"When the person compared two movies on a feature, they cared about <b>how much</b> better or worse each movie was on that feature."];
	}

	strat_instr[q] = strat_instr[q].concat(to_add);

	strat_instr_trial[q] = {
		type: 'instructions',
		pages: strat_instr[q],
		show_clickable_nav: true,
		on_finish: function(data) {
			for (var i = 0; i < data.view_history.length; i++) {
				instructions_times.push(Math.round(data.view_history[i].viewing_time));
			}
		}
	};
}


/* LEX question */

var lex_comp_descriptions = [
	"<b>Person description:</b> When making his choices between movies in Section 1, Ricardo only cared the quality of the soundtrack; he always just chose whichever movie had a better soundtrack.",
 `<b>Person description:</b> When making her choices between movies in Section 1, Sarah cared about three features: how good the humor was, how good the dialogue was, and how good the romantic scenes were. She cared about the humor the most, but also cared a little about the other two features.`
];

var lex_comp_answers = [0,100];
var lex_comp_numbers = [1,2];
shufflethree(lex_comp_descriptions, lex_comp_answers, lex_comp_numbers);

var lex_intro = {
    type: 'survey-multi-choice-twocol-button',
    preamble: strat_preamble,
		questions: function() {
			return ([{prompt: strat_post_intro, options: lex_options, horizontal: true, required: debug ? false : true}]);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
			instructions_times.push(Math.round(data.rt));
    }
};

var lex_comp1 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[0] + "<div class='diff-font'>" + lex_comp_descriptions[0] + "</div>", options: lex_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (lex_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: lex_comp_numbers[0], description: lex_comp_descriptions[0], answer: lex_comp_answers[0]},
		on_finish: function(data) {
      jsPsych.data.addProperties({lex_q_comp1: data.response});
	   	jsPsych.data.addProperties({lex_q_comp1_description: data.description});
	   	jsPsych.data.addProperties({lex_q_comp1_answer: data.answer});
	   	jsPsych.data.addProperties({lex_q_comp1_number: data.number});
			question_rts.lex_q_comp1 = Math.round(data.rt);
    }
};
var lex_comp2 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[1] + "<div class='diff-font'>" + lex_comp_descriptions[1] + "</div>", options: lex_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (lex_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: lex_comp_numbers[1], description: lex_comp_descriptions[1], answer: lex_comp_answers[1]},
		on_finish: function(data) {
      jsPsych.data.addProperties({lex_q_comp2: data.response});
	   	jsPsych.data.addProperties({lex_q_comp2_description: data.description});
	   	jsPsych.data.addProperties({lex_q_comp2_answer: data.answer});
	   	jsPsych.data.addProperties({lex_q_comp2_number: data.number});
			question_rts.lex_q_comp2 = Math.round(data.rt);
    }
};

var lex_real = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_real, options: lex_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (lex_labels_real);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({lex_q_real: data.response});
			question_rts.lex_q_real = Math.round(data.rt);
    }
};

var lex_norm = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_norm, options: lex_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (lex_labels_norm);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({lex_q_norm: data.response});
			question_rts.lex_q_norm = Math.round(data.rt);
    }
};

/* Binary weights question */

var binwts_comp_descriptions = [
	"<b>Person description:</b> When making her choices between movies in Section 1, Leila cared about two features: how good the plot was, and how good the creativity was. She cared about both of those two features an equal amount. To decide which movie was better overall, she compared how much better each movie was on those two features.",
 `<b>Person description:</b> When making her choices between movies in Section 2, Monica cared about four features: the acting, the dialogue, the soundtrack, and the visuals. She cared the most about the acting and the dialogue, but she also cared a little about the other two features.`
];

var binwts_comp_answers = [0,100];
var binwts_comp_numbers = [1,2];
shufflethree(binwts_comp_descriptions, binwts_comp_answers, binwts_comp_numbers);

var binwts_intro = {
    type: 'survey-multi-choice-twocol-button',
    preamble: strat_preamble,
		questions: function() {
			return ([{prompt: strat_post_intro, options: binwts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binwts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
			instructions_times.push(Math.round(data.rt));
    }
};

var binwts_comp1 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[0] + "<div class='diff-font'>" + binwts_comp_descriptions[0] + "</div>", options: binwts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binwts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: binwts_comp_numbers[0], description: binwts_comp_descriptions[0], answer: binwts_comp_answers[0]},
		on_finish: function(data) {
      jsPsych.data.addProperties({binwts_q_comp1: data.response});
	   	jsPsych.data.addProperties({binwts_q_comp1_description: data.description});
	   	jsPsych.data.addProperties({binwts_q_comp1_answer: data.answer});
	   	jsPsych.data.addProperties({binwts_q_comp1_number: data.number});
			question_rts.binwts_q_comp1 = Math.round(data.rt);
    }
};
var binwts_comp2 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[1] + "<div class='diff-font'>" + binwts_comp_descriptions[1] + "</div>", options: binwts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binwts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: binwts_comp_numbers[1], description: binwts_comp_descriptions[1], answer: binwts_comp_answers[1]},
		on_finish: function(data) {
      jsPsych.data.addProperties({binwts_q_comp2: data.response});
	   	jsPsych.data.addProperties({binwts_q_comp2_description: data.description});
	   	jsPsych.data.addProperties({binwts_q_comp2_answer: data.answer});
	   	jsPsych.data.addProperties({binwts_q_comp2_number: data.number});
			question_rts.binwts_q_comp2 = Math.round(data.rt);
    }
};

var binwts_real = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_real, options: binwts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binwts_labels_real);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({binwts_q_real: data.response});
			question_rts.binwts_q_real = Math.round(data.rt);
    }
};

var binwts_norm = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_norm, options: binwts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binwts_labels_norm);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({binwts_q_norm: data.response});
			question_rts.binwts_q_norm = Math.round(data.rt);
    }
};

/* Binary attributes question */

var binatts_comp_descriptions = [
	"<b>Person description:</b> When making his choices between movies in Section 1, Xavier cared about three features: how good the action scenes were, how good the visuals were, and how good the humor was. He checked which movie was better on each feature (i.e. which movie 'won' on each feature), and chose the movie that 'won' on a majority of the three features.",
 `<b>Person description:</b> When making his choices between movies in Section 1, Joe cared about three features: how good the acting was, how good the dialogue was, and how good the romantic scenes were. He considered the difference between the two movies on each feature (e.g. if Movie A had 'Very Good' acting and Movie B had 'Very Bad' acting, that's a huge difference), and then weighed those differences together to figure out which movie was better overall.`
];

var binatts_comp_answers = [0,100];
var binatts_comp_numbers = [1,2];
shufflethree(binatts_comp_descriptions, binatts_comp_answers, binatts_comp_numbers);

var binatts_intro = {
    type: 'survey-multi-choice-twocol-button',
    preamble: strat_preamble,
		questions: function() {
			return ([{prompt: strat_post_intro, options: binatts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binatts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
			instructions_times.push(Math.round(data.rt));
    }
};

var binatts_comp1 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[0] + "<div class='diff-font'>" + binatts_comp_descriptions[0] + "</div>", options: binatts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binatts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: binatts_comp_numbers[0], description: binatts_comp_descriptions[0], answer: binatts_comp_answers[0]},
		on_finish: function(data) {
      jsPsych.data.addProperties({binatts_q_comp1: data.response});
	   	jsPsych.data.addProperties({binatts_q_comp1_description: data.description});
	   	jsPsych.data.addProperties({binatts_q_comp1_answer: data.answer});
	   	jsPsych.data.addProperties({binatts_q_comp1_number: data.number});
			question_rts.binatts_q_comp1 = Math.round(data.rt);
    }
};
var binatts_comp2 = {
    type: 'survey-multi-choice-twocol-slider',
    preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_posts[1] + "<div class='diff-font'>" + binatts_comp_descriptions[1] + "</div>", options: binatts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binatts_labels_comp);
		},
		require_movement: false,//debug ? false : true,
		data: {number: binatts_comp_numbers[1], description: binatts_comp_descriptions[1], answer: binatts_comp_answers[1]},
		on_finish: function(data) {
      jsPsych.data.addProperties({binatts_q_comp2: data.response});
	   	jsPsych.data.addProperties({binatts_q_comp2_description: data.description});
	   	jsPsych.data.addProperties({binatts_q_comp2_answer: data.answer});
	   	jsPsych.data.addProperties({binatts_q_comp2_number: data.number});
			question_rts.binatts_q_comp2 = Math.round(data.rt);
    }
};

var binatts_real = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_real, options: binatts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binatts_labels_real);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({binatts_q_real: data.response});
			question_rts.binatts_q_real = Math.round(data.rt);
    }
};

var binatts_norm = {
    type: 'survey-multi-choice-twocol-slider',
		preamble: ['<span class="transparent-text">' + strat_preamble + '</span>'],
		questions: function() {
			return ([{prompt: strat_post_norm, options: binatts_options, horizontal: true, required: debug ? false : true}]);
		},
		labels: function() {
			return (binatts_labels_norm);
		},
		require_movement: false,//debug ? false : true,
		on_finish: function(data) {
      jsPsych.data.addProperties({binatts_q_norm: data.response});
			question_rts.binatts_q_norm = Math.round(data.rt);
    }
};

// Consistency question1

var consistency_labels = ['0 <br>The Prolific user changed their strategy on every trial', '1', '2 <br>The Prolific user changed their strategy on some trials', '3', '4 <br>The Prolific user was somewhere in the middle', '5', '6 <br>The Prolific user used the same strategy on most trials', '7', '8<br>The Prolific user used the same strategy on every trial'];

var consistency1 = {
    type: jsPsychHtmlSliderResponse,
		require_movement: debug ? false : true,
		start: 0,
    stimulus: '<p>For the decision strategies you said the Prolific user used, how consistently do you think they used these strategies throughout Section 1 of the experiment? <br>In other words, how much did the way they made their choices stay the same from trial to trial?</p>',
    labels: consistency_labels,
		on_finish: function(data) {
			jsPsych.data.addProperties({consistency1: data.response});

			question_rts.consistency1 = Math.round(data.rt);
		}
};

// **Attribute questions

var weight_instructions_intro = {
	type: 'instructions',
	pages: ["In this section, we want to know <b>how much the Prolific user you observed cared about each feature of the movies when making their decisions.</b><br><br>\
	For instance, we'll ask you how much they cared about the acting, the humor, the dialogue, and so on.",
	"We'll ask you a bunch of different questions about this. Some of the questions might not accurately describe how you think they made their decisions. Other times, the questions might feel redundant or repetitive.<br><br>That's okay -- please <b>just do your best to answer each question as accurately as possible.</b>",
	"Also, we specifically want to know how much you think they cared about each feature <b>while making their decisions in Section 1</b>, NOT how much they care about each feature in real life.<br><br>\
	For instance, imagine that, in real life, the Prolific user cares a lot about good acting -- but in this task, they didn't consider acting at all in their choices. In that case, you would <b>say that they didn't care about acting at all</b>."],
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

// WAD

var which_order_word = '';

var attr_instr_text_wad = [", we'll ask you <b>how much</b> the Prolific user cared about each feature when making their decisions. Here's what the questions will look like:<br><br>\
<img src='images/example_introspection.png' width='35%' style='border: 1px solid #000000'></img><br><br>\
So if they didn't care at all about how good the humor was, you'd move the slider to 0; if they cared a moderate amount, you'd move the slider to around 4; \
and if it completely determined their choice, you'd move the slider to 8. And you can move the slider anywhere in between.<br><br>\
When you're ready, press 'Next'."];

var attribute_instructions_wad = {
	type: 'instructions',
	pages: function() {
		return ([attr_instr_text_wad]);
	},
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

var label = ["0 <br> Didn't care about it at all", '1', '2 <br> Cared a little', '3', '4 <br> Cared somewhat', '5', '6 <br> Cared a lot', '7', '8<br>It completely determined their choices']
var prompt = '<br><br><br><br>How much did the Prolific user care about this feature when making their decisions?';
var attribute_ratings = new Array(home_attributes.length);

for (var i = 0; i < home_attributes.length; i++) {
	att = home_attributes[i];
	attribute_ratings[i] = {
  	type: jsPsychHtmlSliderResponse,
		labels: label,
  	stimulus: '<b>' + att.display_name + '</b>',
		prompt: prompt,
		max: 100,
		slider_start: 0,
	 	require_movement: debug ? false : true,
		data: {which_trial: i, attribute_name: att.name},
		on_finish: function(data) {
				s2_data = {
					subject: data.subject,
					version: data.version,
					assignmentId: subject_id_url,
					trial: data.which_trial,
					type: 'wad_att_rating',
					attribute: data.attribute_name,
					rating: data.response,
					rt: data.rt
				}

				save_data(s2_data, 's2');
		}
	};
}

attribute_ratings = _.shuffle(attribute_ratings);

// Attribute questions: EW

var attr_instr_text_ew = [", we'll ask <b>which</b> features of the movies the Prolific user cared about when making their decisions. This is what the question will look like:<br><br>\
<img src='images/example_introspection_ew.png' width='65%' style='border: 1px solid #000000'></img><br><br>\
So if they cared about the movies' creativity and visuals, and didn't care about any of the other features, you'd check 'Creativity' and 'Visuals' and not check any of the others.<br><br>\
When you're ready, press 'Next'."];

var attribute_instructions_ew = {
	type: 'instructions',
	pages: function() {
		return ([attr_instr_text_ew]);
	},
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

home_attribute_display_names_ext = [...home_attribute_display_names];
var attribute_ratings_ew = {
		type: 'survey-multi-select',
		questions: [
			{prompt: '<b>Which features did the Prolific user care about when making their choices?</b><br><br>(You can select as little as just 1 feature if they only cared about 1, or as many as all 9 features if they cared about all 9.)', options: home_attribute_display_names, required : debug ? false : true, horizontal: false}
		],
		preamble: '',
		on_finish: function(data) {
			var ans = data.response.Q0;

			for (var i = 0; i < ans.length; i++) {
					s2_data = {
						subject: data.subject,
						version: data.version,
						assignmentId: subject_id_url,
						trial: 0,
						type: 'ew_att_rating',
						attribute: ans[i],
						rating: 1,
						rt: data.rt
					}
				save_data(s2_data, 's2');
			}
		}
}


// Attribute questions: LEX

var attr_instr_text_lex = [", we'll ask <b>which single feature of the movies</b> the Prolific user <u>MOST</u> used to make their decisions. \
The question will look like this:<br><br>\
<img src='images/example_introspection_lex.png' width='60%' style='border: 1px solid #000000'></img><br><br>\
For instance, maybe you think they primarily made their decision based on the quality of the plot. If so, you would select 'Plot' for this question.<br><br>\
When you're ready, press 'Next'."];

var attribute_instructions_lex = {
	type: 'instructions',
	pages: function() {
		return ([attr_instr_text_lex]);
	},
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

var attribute_ratings_lex = {
		type: 'survey-multi-choice',
		questions: [
			{prompt: '<b>What single feature did the Prolific user <u>MOST</u> use to make their choices?</b>', options: home_attribute_display_names, required : debug ? false : true, horizontal: false}
		],
		preamble: '',
		on_finish: function(data) {
				s2_data = {
					subject: data.subject,
					version: data.version,
					assignmentId: subject_id_url,
					trial: 0,
					attribute: data.response.Q0,
					type: 'lex_att_rating',
					rating: 1,
					rt: data.rt
				}
			save_data(s2_data, 's2');
		}
}

var appropriateness = {
    type: jsPsychHtmlSliderResponse,
		require_movement: debug ? false : true,
    stimulus: `Great job.<br><p>Throughout Section 2, we've asked you various questions about how you think the Prolific user made their choices in Section 1. <b>How well have these questions captured the way you think they made their choices?</b>
		Do you think that, by answering these questions, you've accurately and fully described how they made their choices in Section 1? Or are there important aspects of their decision-making process that we've missed?</p>`,
    labels: ['0<br>These questions totally failed to capture how the Prolific user made their choices in Section 1', '1', '2', '3', '4', '5', '6', '7', '8 <br>These questions completely captured how the Prolific user made their choices in Section 1'],
		on_finish: function(data) {
			jsPsych.data.addProperties({appropriateness: data.response});

			question_rts.appropriateness = Math.round(data.rt);
		}
};

var consistency_labels2 = ['0<br>The amount they cared about each feature changed on every trial', '1', '2<br>The amount they cared about each feature changed on some trials', '3', '4<br>They were somewhere in the middle', '5', '6<br>The amount they cared about each feature was the same on most trials', '7', '8<br>The amount they cared about each feature was the same on every trial'];

var consistency2 = {
    type: jsPsychHtmlSliderResponse,
		require_movement: debug ? false : true,
    stimulus: '<p>On average, how consistent was the amount that the Prolific user cared about each feature throughout Section 1 of the task? \
		<br>In other words, how much did the amount they cared about each feature stay the same from trial to trial?</p>',
    labels: consistency_labels2,
		on_finish: function(data) {
			jsPsych.data.addProperties({consistency2: data.response});

			question_rts.consistency2 = Math.round(data.rt);
		}
};

/* get directions */

/* get directions */

var attr_instr_text_direction = [
	"Now, we'll ask you one last set of questions about each feature of the movies.",

	"Some of these questions might seem obvious. That's okay; if the answer feels obvious, just give that obvious answer. (We're not giving you any trick questions.)",

	"When you're ready to start, press 'Next'."
];

var attribute_instructions_direction = {
	type: 'instructions',
	pages: attr_instr_text_direction,
	show_clickable_nav: true,
	on_finish: function(data) {
		for (var i = 0; i < data.view_history.length; i++) {
			instructions_times.push(Math.round(data.view_history[i].viewing_time));
		}
	}
};

var attribute_ratings_direction = new Array(home_attributes.length);
var last_trial_val = null;

function makeArr(startValue, stopValue, cardinality) {
  var arr = [];
  var step = (stopValue - startValue) / (cardinality - 1);
  for (var i = 0; i < cardinality; i++) {
    arr.push(startValue + (step * i));
  }
  return arr;
}

atts_shuffled = _.shuffle(home_attributes);

var comparisons = [[0,4], [0,1], [1,2], [2,3], [3,4]];

for (var i = 0; i < atts_shuffled.length; i++) {
	att = atts_shuffled[i];
	var cur_scale = movie_scale;

	attribute_ratings_direction[i] = new Array(comparisons.length+1);

	var opening_instr = '';
	if (i == 0) {
		opening_instr = "First, we're going to ask you about the feature <b>" + att.display_name + "</b>.";
	} else if (i < (atts_shuffled.length - 1)) {
		opening_instr = "Next, we're going to ask you the same questions about the feature <b>" + att.display_name + "</b>.";
	} else {
		opening_instr = "Finally, we're going to ask you the same questions about the feature <b>" + att.display_name + "</b>.";
	}

	attribute_ratings_direction[i][0] = {
		type: 'instructions',
		pages: [opening_instr],
		show_clickable_nav: true
	}

	for (var j = 0; j < comparisons.length; j++) {
		var preamble = '';
		if (j == 0) {
			preamble = "Imagine that, in Section 1, the Prolific user had been given a choice between two movies which were <u>identical in every way</u>, EXCEPT that they had different scores for the feature '" + att.display_name + "'.";
		} else {
			preamble = "Now imagine another two movies, which were again identical in every way except that they had different scores for the feature '" + att.display_name + "'.";
		}

		var cur_options = ["The movie where '" + att.display_name + "' was <b>" + cur_scale[comparisons[j][0]] + "</b>",
			"The movie where '" + att.display_name + "' was <b>" + cur_scale[comparisons[j][1]] + "</b>"];
		attribute_ratings_direction[i][j+1] = {
			type: 'survey-multi-choice',
			questions: [
				{prompt: "Which of these two movies would the Prolific user have chosen?",
				options: cur_options,
				required: debug ? false : true, horizontal: true},
			],
			preamble: preamble +
				"<br><br>For one of the movies, '" + att.display_name + "' had a score of <b>" + cur_scale[comparisons[j][0]] +
				"</b>. For the other movie, '" + att.display_name + "' had a score of <b>" + cur_scale[comparisons[j][1]] + "</b>.",
			data: {which_trial: i, attribute_name: att.name, comp1: cur_scale[comparisons[j][0]], comp2: cur_scale[comparisons[j][1]], options: cur_options},
			on_finish: function(data) {
				s2_data = {
					subject: data.subject,
					version: data.version,
					assignmentId: subject_id_url,
					trial: data.which_trial,
					attribute: data.attribute_name,
					type: 'direction',
					rating: data.options.indexOf(data.response.Q0),
					least_preferred: data.comp1,
					most_preferred: data.comp2,
					rt: data.rt
				}

				save_data(s2_data, 's2');
			}
		}
	}
}

var strategy = {
	type: 'survey-text',
	questions: [
	{prompt: "Please describe, in your own words, how you think the Prolific user made their choices between movies in Section 1 of this study.", name: 'strategy', required: debug ? false : true, rows: 15, columns: 100},
	],
	on_finish: function(data) {
		jsPsych.data.addProperties({strategy: data.response.strategy});

		question_rts.strategy = Math.round(data.rt);
	}
};

var strategy2 = {
	type: 'survey-text',
	questions: [
	{prompt: "Before, we asked you to describe in your own words how you think the Prolific user made choices in Section 1. After answering all the questions in this section, how would you describe their strategy now? Has your description changed at all?", name: 'strategy2', required: debug ? false : true, rows: 15, columns: 100},
	],
	on_finish: function(data) {
		jsPsych.data.addProperties({strategy2: data.response.strategy2});

		question_rts.strategy2 = Math.round(data.rt);
	}
};

/* begin Part 3 */

var confidence = {
    type: jsPsychHtmlSliderResponse,
		require_movement: debug ? false : true,
    stimulus: "Great job. We now have some further questions for you about yourself and how you think the Prolific user made choices in the experiment. The remainder of the experiment should take about 15-20 minutes. (Note that, for some of these questions, you may have to move the slider first in order to activate the 'Continue' button and continue to the next trial.)\
		<br><br><p>How confident are you that, when answering the questions in Section 2 of the task, you knew exactly how the Prolific user made their choices in Section 1?</p>",
    labels: ['0<br>Not at all confident', '1', '2', '3', '4', '5', '6', '7', '8<br>Very confident'],
		on_finish: function(data) {
			jsPsych.data.addProperties({confidence: data.response});

			question_rts.confidence = Math.round(data.rt);

			/*jsPsych.data.addProperties({satisfaction: ''});
			question_rts.satisfaction = -1;*/
		}
};

var metastrategy = {
    type: 'survey-text',
    questions: [
      {prompt: "In Section 2 of this study, we asked you questions about how you think the Prolific user made their choices in Section 1. How did you answer those questions in Section 2? In other words, how did you know what the Prolific user's choice process was?", required: debug ? false : true, rows: 10, columns: 100}
    ],
  on_finish: function(data){
		jsPsych.data.addProperties({metastrategy: data.response.Q0});

		question_rts.metastrategy = Math.round(data.rt);
  }
};

var attention = {
	type: jsPsychHtmlSliderResponse,
	require_movement: debug ? false : true,
    stimulus: "<p>How attentive were you throughout the experiment? (Please be honest; we understand that it's hard to focus throughout the study, and we will accept your submission no matter how you answer.)</p>",
    labels: ['0<br>Very Inattentive', '1', '2<br>Quite Inattentive', '3', '4<br>Moderate', '5', '6<br>Quite Attentive', '7', '8<br>Very Attentive'],
		on_finish: function(data) {
			jsPsych.data.addProperties({attention: data.response});

			question_rts.attention = Math.round(data.rt);
		}
};

var choice_exp_options = ["0","1-5","5-10","10-15","15+"];
var choice_exp = {
        type: 'html-button-response',
        stimulus: "<p>How many studies like this one (involving choices between two options which varied on many features) have you participated in before?</p>",
        choices: choice_exp_options,
				on_finish: function(data) {
					jsPsych.data.addProperties({choice_exp: choice_exp_options[data.response]});

					question_rts.choice_exp = Math.round(data.rt);
				}
    };

var choice_domain = {
	type: jsPsychHtmlSliderResponse,
    stimulus: "In your life, how much time have you spent thinking about which movies to watch?",
    labels: ['0<br>Very little time', '1<br>Some time', '2<br>A lot of time', '3<br>Tons of time'],
		require_movement: debug ? false : true,
		on_finish: function(data) {
			jsPsych.data.addProperties({choice_domain: data.response});

			question_rts.choice_domain = Math.round(data.rt);
		}
};

var med_exp1 = null;
var meditation_experience1 = {
	type: 'survey-multi-choice',
    questions: [{prompt: "Have you tried mindfulness meditation in the past?", options: ['Yes', 'No'], required: debug ? false : true}],
		on_finish: function(data) {
			jsPsych.data.addProperties({meditation_exp1: data.response.Q0});
			med_exp1 = data.response.Q0;
		}
};

var med_exp2 = null;
var meditation_experience2 = {
	type: 'survey-multi-choice',
		questions: [{prompt: "For how many years have you practiced mindfulness meditation?", options: ['Less than 1 year', 'Between 1-5 years', 'More than 5 years'], required: debug ? false : true}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp2: data.response.Q0});
				med_exp2 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};

var meditation_experience3 = {
	type: 'survey-text',
		questions: [{prompt: "How many times have you practiced mindfulness meditation in the past 30 days? (Please enter a number below.)", required: debug ? false : true}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp3: data.response.Q0});
				med_exp3 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};

var meditation_experience4 = {
	type: 'survey-text',
		questions: [{prompt: "In the past 30 days, on average, how many minutes did you spend meditating in each session? (Please enter a number below.)", required: debug ? false : true}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp4: data.response.Q0});
				med_exp4 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};

var meditation_experience5 = {
	type: 'survey-multi-choice',
		questions: [{prompt: "Have you ever received mindfulness training or participated in a mindfulness/acceptance-based therapy program?", options: ['Yes', 'No'], required: debug ? false : true}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp5: data.response.Q0});
				med_exp5 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};

var meditation_experience6 = {
	type: 'survey-multi-choice',
		questions: [{prompt: "Select the option that best describes your experience with mindfulness meditation.", options: ['I am relatively new to mindfulness meditation.', 'I have a moderate amount of experience with mindfulness meditation.', 'I have an extensive amount of experience with mindfulness meditation.'], required: debug ? false : true, horizontal: false}],
		required: debug ? false : true,
		on_finish: function(data) {
			if (med_exp1 == 'Yes') {
				jsPsych.data.addProperties({meditation_exp6: data.response.Q0});
				med_exp6 = data.response.Q0;
			}
		},
		skip: function() {return (med_exp1 == 'Yes' ? false : true)}
};

var gen_choices = ['Man', 'Woman','Some other way', 'Prefer not to say'];
var gen = {
	type: 'survey-multi-choice',
	preamble: "Finally, we'll ask you to input some demographic information.",
	questions: [{prompt: "<b>Gender:</b> Do you describe yourself as a man, a woman, or in some other way?", options: gen_choices,
		required: false}],
	on_finish: function(data){
		jsPsych.data.addProperties({gender: data.response.Q0});
	}
};

var age_years = {
		type: 'survey-text',
		questions: [
			{prompt: "Age:", required: false}
		],
	on_finish: function(data){
		jsPsych.data.addProperties({age: data.response.age});
	}
};

var race_options = ['White', 'Hispanic, Latinx, or Spanish origin', 'Black or African American', 'Asian', 'American Indian or Alaska Native', 'Middle Eastern or North African', 'Native Hawaiian or Other Pacific Islander', 'Some other race, ethnicity, or origin', 'Prefer not to say'];
var race = {
	type: 'survey-multi-select',
	questions: [{prompt: '<b>Race/ethnicity</b>: Which categories below describe you? Please select all that apply.', options: race_options,
		required: false}],
	on_finish: function(data){
		jsPsych.data.addProperties({race: JSON.stringify(data.response.Q0)});
	}
};


var nativeEng_options = ['Yes', 'No', 'Prefer not to say'];
var nativeEng = {
	type: 'html-button-response',
	stimulus: 'Is English your first language?<br>',
	choices: nativeEng_options,
	on_finish: function(data){
		jsPsych.data.addProperties({nativeEng: nativeEng_options[data.response]});
	}
};

var edu_options = ["Some high school","High school", "Some college", "2 year degree", "4 year degree", "Postgraduate/Professional degree/other", "Prefer not to say"];
var edu = {
	type: 'html-button-response',
	stimulus: 'What is the highest level of education that you have completed?<br>',
	choices: edu_options,
	on_finish: function(data){
		jsPsych.data.addProperties({edu: edu_options[data.response]});
	}
};

var income_options = ['Under $5,000', '$5,000 - $10,000', '$10,000 - $15,000', '$15,000 - $25,000', '$25,000 - $35,000', '$35,000 - $50,000', '$50,000 - $65,000', '$65,000 - $80,000', '$80,000 - $100,000', 'Over $100,000', 'Prefer not to say'];
var income = {
	type: 'html-button-response',
	stimulus: 'What was the total amount of income you earned during the last year?<br>',
	choices: income_options,
	on_finish: function(data){
		jsPsych.data.addProperties({income: income_options[data.response]});
	}
};

var permission = {
	type: 'survey-multi-choice',
	preamble: ["Earlier in the task, we asked you several questions about how you think the Prolific user made their choices between movies in Section 1 of this study.<br><br>\
	At some point in the future, we may want to anonymously quote some of your responses to these questions in other studies, or in scientific publications resulting from this research. \
	Do you wish to give us permission to quote your answers? The quoted content would be <b>completely anonymous</b> and would not contain any information that could be linked back to you in any way. If you do not wish to have your answers to these questions quoted, you can select 'No' and there will not be any negative consequences."],
	questions: [{prompt: '', options: ['Yes, I am okay with my answers to these questions being quoted anonymously.', 'No, please do not quote my answers to these questions.'],
		required: false, horizontal: false, use_default: true}],
	on_finish: function(data){
		jsPsych.data.addProperties({permission: data.response.Q0});
	}
};

/* IQ TEST */

var items = [
  {prompt: "<hr>What number is one fifth of one fourth of one ninth of 900?", name: 'VR.4', options: [2,3,4,5,6,7], horizontal:true, required: debug ? false : true},
  {prompt: "<hr>Zach is taller than Matt and Richard is shorter than Zach. Which of the following statements would be most accurate?", name: "VR.16", options: ["Richard is taller than Matt","Richard is shorter than Matt","Richard is as tall as Matt","It is impossible to tell"], horizontal:true, required:debug ? false : true},
  {prompt: "<hr>Joshua is 12 years old and his sister is three times as old as he. When Joshua is 23 years old, how old will his sister be?", name: "VR.17", options: [35,39,44,47,53,57], horizontal:true, required:debug ? false : true},
  {prompt: "<hr>If the day after tomorrow is two days before Thursday then what day is it today?", name: "VR.19", options: ["Friday","Monday","Wednesday","Saturday","Tuesday","Sunday"], horizontal:true, required:debug ? false : true},
  {prompt: "<hr>In the following alphabetic series, what letter comes next? \n K N P S U", name:"LN.7", options: ["S","T","U","V","W","X"], horizontal:true, required: debug ? false : true},
  {prompt: "<hr>In the following alphabetic series, what letter comes next? \n V Q M J H", name:"LN.33", options: ["E","F","G","H","I","J"], horizontal:true, required: debug ? false : true},
  {prompt: "<hr>In the following alphabetic series, what letter comes next? \n I J L O S", name:"LN.34", options: ["T","U","V","X","Y","Z"], horizontal:true, required: debug ? false : true},
  {prompt: "<hr>In the following alphabetic series, what letter comes next? \n Q S N P L", name:"LN.58", options: ["J","H","I","N","M","L"], horizontal:true, required: debug ? false : true},
  {prompt: "<hr>Please indicate which is the best answer to complete the figure below.<br><br><img src='images/MX.45.PNG' width='50%''></img>", name: "MX.45", options: ["A","B","C","D","E","F"],horizontal:true, required: debug ? false : true},
  {prompt: "<hr>Please indicate which is the best answer to complete the figure below.<br><br><img src='images/MX.46.PNG' width='50%''></img>", name: "MX.46", options: ["A","B","C","D","E","F"],horizontal:true, required: debug ? false : true},
  {prompt: "<hr>Please indicate which is the best answer to complete the figure below.<br><br><img src='images/MX.47.PNG' width='50%''></img>", name: "MX.47", options: ["A","B","C","D","E","F"],horizontal:true, required: debug ? false : true},
  {prompt: "<hr>Please indicate which is the best answer to complete the figure below.<br><br><img src='images/MX.55.PNG' width='50%''></img>", name: "MX.55", options: ["A","B","C","D","E","F"],horizontal:true, required: debug ? false : true},
  {prompt: "<hr>All the cubes below have different image on each side.<br> Select the choice that represents a rotation of the cube labeled X.<br><br><img src='images/R3D.3.PNG' width='50%''></img>", name: "R3D.3", options: ["A","B","C","D","E","F","G","H"], horizontal:true, required: debug ? false : true},
  {prompt: "<hr>All the cubes below have different image on each side.<br> Select the choice that represents a rotation of the cube labeled X.<br><br><img src='images/R3D.4.PNG' width='50%''></img>", name: "R3D.4", options: ["A","B","C","D","E","F","G","H"], horizontal:true, required: debug ? false : true},
  {prompt: "<hr>All the cubes below have different image on each side.<br> Select the choice that represents a rotation of the cube labeled X.<br><br><img src='images/R3D.5.PNG' width='50%''></img>", name: "R3D.6", options: ["A","B","C","D","E","F","G","H"], horizontal:true, required: debug ? false : true},
  {prompt: "<hr>All the cubes below have different image on each side.<br> Select the choice that represents a rotation of the cube labeled X.<br><br><img src='images/R3D.8.PNG' width='50%''></img>", name: "R3D.8", options: ["A","B","C","D","E","F","G","H"], horizontal:true, required: debug ? false : true},
];

correct_response = {
	"LN.7" : "X",
	"LN.33" : "G",
	"LN.34" : "X",
	"LN.58" : "N",
	"MX.45" : "E",
	"MX.46" : "B",
	"MX.47" : "B",
	"MX.55" : "D",
	"R3D.3" : "C",
	"R3D.4" : "B",
	"R3D.6" : "F",
	"R3D.8" : "G",
	"VR.4" : "5",
	"VR.16" : "It is impossible to tell",
	"VR.17" : "47",
	"VR.19" : "Sunday"
}

var intro_to_icar_text = ["On the next page, you will be asked to complete some logic puzzles. You should try to complete these puzzles in about 10-15 minutes. It's okay if you can't get them all right within that time; just do your best."]
var icar_intro = {
	type: 'instructions',
	pages: intro_to_icar_text,
	show_clickable_nav: true
};

var correct_ans = [];
var icar_responses = null;
var icar = {
	type: 'survey-multi-choice',
	questions: items,
	preamble:"<b>Please answer each question below to the best of your ability.</b> The questions range in difficulty; some may be quite difficult.<br><br><b><u>Do not</u> write anything down during the task; you should try to solve each problem <u>in your head</u>.</b><br><br>(Please be honest in taking this test; your payment will not depend in any way on your score.)",
	button_label: "Submit",
	randomize_question_order: true,
	on_finish: function(data) {
		icar_responses = JSON.stringify(data.response);

		correct_resp_keys = Object.keys(correct_response);
		correct_resp_values = Object.values(correct_response);
		participant_resp_keys = Object.keys(data.response);
		participant_resp_values = Object.values(data.response);
		for(var i=0; i<correct_resp_keys.length; i++){
		  for(var j=0; j<correct_resp_keys.length; j++){
		      if(correct_resp_keys[i]==participant_resp_keys[j]){
		          if(correct_resp_values[i]==participant_resp_values[j]){
		              correct_ans.push(participant_resp_keys[j]);
		          }
		      }
		  }
		}
		jsPsych.data.addProperties({correct_answers: correct_ans});

		question_rts.icar = Math.round(data.rt);
	}
};

var suspicion = {
	type: 'survey-text',
    questions: [{prompt: "Last two questions. In section 1 of this study (where you observed someone else's choices between movies and tried to figure out their strategy), was there anything you were suspicious about?", required: debug ? false : true, rows: 15, columns: 100}],
		on_finish: function(data) {
			jsPsych.data.addProperties({suspicion: data.response.Q0});
		}
};

var suspicion2 = {
	type: 'survey-multi-choice',
    questions: [{prompt: "While you were doing section 1 of the study, did you think that the choices you were observing were made by a real Prolific user?", options: ['Yes', 'No'], required: debug ? false : true}],
		on_finish: function(data) {
			jsPsych.data.addProperties({suspicion2: data.response.Q0});
		}
};

var feedback = {
	type: 'survey-text',
	questions: [
	{prompt: "Thanks for participating! Just so you know, the choices you observed in section 1 were indeed from a real Prolific user; we didn't lie to you. We just ask the previous questions to check that people believed us.<br><br>Do you have any feedback for us about the study? Was there anything confusing? Did it take about as much time as we said it would?",
		name: 'feedback', required: false, rows: 15, columns: 100},
	],
	on_finish: function(data) {
		jsPsych.data.addProperties({feedback: data.response.feedback});

		demo_data = {
			subject: data.subject,
			version: data.version,
			assignmentId: subject_id_url,
			lex_real: checkvar(data.lex_q_real),
			lex_norm: checkvar(data.lex_q_norm),
			lex_comp1: checkvar(data.lex_q_comp1),
			lex_comp1_number: checkvar(data.lex_q_comp1_number),
			lex_comp1_description: checkvar(data.lex_q_comp1_description, 400),
			lex_comp1_answer: checkvar(data.lex_q_comp1_answer),
			lex_comp2: checkvar(data.lex_q_comp2),
			lex_comp2_number: checkvar(data.lex_q_comp2_number),
			lex_comp2_description: checkvar(data.lex_q_comp2_description, 400),
			lex_comp2_answer: checkvar(data.lex_q_comp2_answer),
			binwts_real: checkvar(data.binwts_q_real),
			binwts_norm: checkvar(data.binwts_q_norm),
			binwts_comp1: checkvar(data.binwts_q_comp1),
			binwts_comp1_number: checkvar(data.binwts_q_comp1_number),
			binwts_comp1_description: checkvar(data.binwts_q_comp1_description, 400),
			binwts_comp1_answer: checkvar(data.binwts_q_comp1_answer),
			binwts_comp2: checkvar(data.binwts_q_comp2),
			binwts_comp2_number: checkvar(data.binwts_q_comp2_number),
			binwts_comp2_description: checkvar(data.binwts_q_comp2_description, 400),
			binwts_comp2_answer: checkvar(data.binwts_q_comp2_answer),
			binatts_real: checkvar(data.binatts_q_real),
			binatts_norm: checkvar(data.binatts_q_norm),
			binatts_comp1: checkvar(data.binatts_q_comp1),
			binatts_comp1_number: checkvar(data.binatts_q_comp1_number),
			binatts_comp1_description: checkvar(data.binatts_q_comp1_description, 400),
			binatts_comp1_answer: checkvar(data.binatts_q_comp1_answer),
			binatts_comp2: checkvar(data.binatts_q_comp2),
			binatts_comp2_number: checkvar(data.binatts_q_comp2_number),
			binatts_comp2_description: checkvar(data.binatts_q_comp2_description, 400),
			binatts_comp2_answer: checkvar(data.binatts_q_comp2_answer),
			confidence: checkvar(data.confidence),
			strategy: checkvar(data.strategy, 2000),
			strategy2: checkvar(data.strategy2, 2000),
			consistency1: checkvar(data.consistency1),
			consistency2: checkvar(data.consistency2),
			appropriateness: checkvar(data.appropriateness),
			attention: checkvar(data.attention),
			choice_exp: checkvar(data.choice_exp, 50),
			choice_domain: checkvar(data.choice_domain),
			meditation_exp1: checkvar(data.meditation_exp1, 10),
			meditation_exp2: checkvar(data.meditation_exp2, 50),
			meditation_exp3: checkvar(data.meditation_exp3, 100),
			meditation_exp4: checkvar(data.meditation_exp4, 100),
			meditation_exp5: checkvar(data.meditation_exp5, 10),
			meditation_exp6: checkvar(data.meditation_exp6, 100),
			metastrategy: checkvar(data.metastrategy, 2000),
			question_rts: checkvar(JSON.stringify(question_rts), 1000),
			gender: checkvar(data.gender, 50),
			age: checkvar(data.age, 50),
			race: checkvar(data.race, 50),
			edu: checkvar(data.edu, 50),
			income: checkvar(data.income, 50),
			nativeEng: checkvar(data.nativeEng, 50),
			permission: checkvar(data.permission, 50),
			icar_responses: checkvar(icar_responses, 500),
			icar_correct: checkvar(JSON.stringify(correct_ans), 500),
			icar_num_correct: checkvar(correct_ans.length),
			suspicion: checkvar(data.suspicion, 1000),
			suspicion2: checkvar(data.suspicion2),
			feedback: checkvar(data.feedback, 1000),
			attention_check: checkvar(data.attention_check, 100),
			instructions_times: checkvar(JSON.stringify(instructions_times), 1000),
			section2_order: checkvar(section2_order.toString(),50),
			strat_q_order: checkvar(strat_q_order.toString(),50),
			weight_q_order: checkvar(weight_q_order.toString(),50),
			target_num: checkvar(target_num),
			observer_num: checkvar(y),
			target_id: checkvar(trials_db[target_num][0].subject, 100),
			target_id_num: checkvar(trials_db[target_num][0].subject_num),
			target_version: checkvar(trials_db[target_num][0].version, 100),
			total_time: Date.now() - start_instructions
		}

		save_data(demo_data, 'demo');

		$.ajax({
				type: "GET",
				url: "https://amorris.mprlab327.opalstacked.com/ma_choice/v4_movie_observers/completed.csv",
				dataType: "text",
				async: false,
				success: function(d) {
					if (d.length > 0) {
						completed = Papa.parse(d, {dynamicTyping: true}).data[0];
					} else {
						completed = [];
					}
				},
				error: function(xhr, ajaxOptions, thrownError) {
						alert("Status: " + xhr.status + "     Error: " + thrownError);
				}
		});

		completed.push(target_num);
		write_array_to_csv('completed.csv', completed);
	}
};

var debrief = {
	type: 'instructions',
	pages: ["You're done with the " + (both_halves ? 'first half of the study! Within 24 hours, you will be invited to take the second half of the study. <b><u>Please remember to take the second half of the study!</u></b> In addition to the base pay, it will offer a $1 completion bonus.' : 'study!') + "<br><br>\
	Bonuses will be paid within a week after study completion. Click 'Next' to receive your Prolific completion code."],
	show_clickable_nav: true
};

var exit_fullscreen = {
  type: 'fullscreen',
  fullscreen_mode: false,
  delay_after: 0
}

var timeline = []
var section2_order = _.shuffle(['features', 'weights']);
var weight_q_order = _.shuffle(['wad', 'ew', 'lex']);

// INTRO
timeline.push(get_id_loop);
timeline.push(welcome);
if (!debug) {
	timeline.push(fullscreen);
	timeline.push(consent_block);
	timeline.push(attnCheck1);
}

// PART 1
timeline.push(instructions);
for (var t = 0; t < num_practice_trials_to_use; t++) {
	timeline.push(fixation);
	timeline.push(practice_trials[t]);
}
timeline.push(instructions2);
for (var t = 0; t < num_trials_to_use; t++) {
	timeline.push(fixation);
	timeline.push(trials[t]);
}

// PART 2: process questions
timeline.push(attribute_instructions);

timeline.push(strategy);

for (var k = 0; k < section2_order.length; k++) {
	if (section2_order[k] == 'features') {
		timeline.push(strat_instructions_intro);
		for (var q = 0; q < 3; q++) {
			var strat_order_word = strat_order_words[q];
			timeline.push(strat_instr_trial[q]);

			if (strat_q_order[q] == 'lex') {
				lex_options[0] = "<u><b>Strategy " + strat_order_word[0] + ":</b></u> " + lex_options[0];
				lex_options[1] = "<u><b>Strategy " + strat_order_word[1] + ":</b></u> " + lex_options[1];
				var lex_labels_comp = get_strat_labels(strat_order_word[0], strat_order_word[1], 'comp');
				var lex_labels_real = get_strat_labels(strat_order_word[0], strat_order_word[1], 'real');
				var lex_labels_norm = get_strat_labels(strat_order_word[0], strat_order_word[1], 'norm');
				timeline.push(lex_intro);
				timeline.push(lex_comp1);
				timeline.push(lex_comp2);
				timeline.push(lex_real);
				timeline.push(lex_norm);
			} else if (strat_q_order[q] == 'binwts') {
				binwts_options[0] = "<u><b>Strategy " + strat_order_word[0] + ":</b></u> " + binwts_options[0];
				binwts_options[1] = "<u><b>Strategy " + strat_order_word[1] + ":</b></u> " + binwts_options[1];
				var binwts_labels_comp = get_strat_labels(strat_order_word[0], strat_order_word[1], 'comp');
				var binwts_labels_real = get_strat_labels(strat_order_word[0], strat_order_word[1], 'real');
				var binwts_labels_norm = get_strat_labels(strat_order_word[0], strat_order_word[1], 'norm');
				timeline.push(binwts_intro);
				timeline.push(binwts_comp1);
				timeline.push(binwts_comp2);
				timeline.push(binwts_real);
				timeline.push(binwts_norm);
			} else if (strat_q_order[q] == 'binatts') {
				binatts_options[0] = "<u><b>Strategy " + strat_order_word[0] + ":</b></u> " + binatts_options[0];
				binatts_options[1] = "<u><b>Strategy " + strat_order_word[1] + ":</b></u> " + binatts_options[1];
				var binatts_labels_comp = get_strat_labels(strat_order_word[0], strat_order_word[1], 'comp');
				var binatts_labels_real = get_strat_labels(strat_order_word[0], strat_order_word[1], 'real');
				var binatts_labels_norm = get_strat_labels(strat_order_word[0], strat_order_word[1], 'norm');
				timeline.push(binatts_intro);
				timeline.push(binatts_comp1);
				timeline.push(binatts_comp2);
				timeline.push(binatts_real);
				timeline.push(binatts_norm);
			}
		}
		timeline.push(consistency1);
	} else if (section2_order[k] == 'weights') {
		// weight questions
		timeline.push(weight_instructions_intro);
		var order_words = ['First', 'Second', 'Third'];
		for (var i = 0; i < 3; i++) {
			which_order_word = order_words[i];
			if (weight_q_order[i] == 'wad') {
				attr_instr_text_wad = which_order_word + attr_instr_text_wad;
				timeline.push(attribute_instructions_wad);
				for (var j = 0; j < num_attributes_to_ask_about; j++) {
					timeline.push(attribute_ratings[j]);
				}
			} else if (weight_q_order[i] == 'ew') {
				attr_instr_text_ew = which_order_word + attr_instr_text_ew;
				timeline.push(attribute_instructions_ew);
				timeline.push(attribute_ratings_ew);
			} else if (weight_q_order[i] == 'lex') {
				attr_instr_text_lex = which_order_word + attr_instr_text_lex;
				timeline.push(attribute_instructions_lex);
				timeline.push(attribute_ratings_lex);
			}
		}
		timeline.push(consistency2);
	}
}

timeline.push(appropriateness);

timeline.push(attribute_instructions_direction);
for (var i = 0; i < num_attributes_to_ask_about; i++) {
	for (var j = 0; j < attribute_ratings_direction[i].length; j++) {
		timeline.push(attribute_ratings_direction[i][j]);
	}
}

timeline.push(strategy2);

// PART 3
timeline.push(confidence);
timeline.push(metastrategy);
timeline.push(attention);
timeline.push(choice_domain);
timeline.push(choice_exp);
timeline.push(meditation_experience1);
timeline.push(meditation_experience2);
timeline.push(meditation_experience3);
timeline.push(meditation_experience4);
timeline.push(meditation_experience5);
timeline.push(meditation_experience6);
timeline.push(gen);
timeline.push(age_years);
timeline.push(race);
timeline.push(nativeEng);
timeline.push(edu);
timeline.push(income);
timeline.push(permission);
timeline.push(icar_intro);
timeline.push(icar);
timeline.push(suspicion);
timeline.push(suspicion2);
timeline.push(feedback);
timeline.push(debrief);
timeline.push(exit_fullscreen);

var browser_events = new Array();
jsPsych.init({
	timeline: timeline,
	show_progress_bar: true,
   on_finish: function() {
    document.body.innerHTML = '<p><p><p align="center">Thank you for participating in the study!<p align="center"><b>You will be automatically re-directed to Prolific in a few moments.</b></p>';
    setTimeout(function () { location.href = "https://app.prolific.co/submissions/complete?cc=3F3EE65E" }, 5000)
	},
	on_interaction_data_update: function(data) {
		if (subject_id != '') {
			var browser_event = {
				subject: subject_id,
				version: study_version,
				browser_event: data.event,
				trial: data.trial,
				time: data.time
			}
			save_data(browser_event, 'browser_events');
	  }
	}
});

</script>
</html>